#!/bin/sh

coded_by='

In the name of Allah, the most Gracious, the most Merciful.

 ▓▓▓▓▓▓▓▓▓▓
░▓ Author ▓ Abdullah <https://abdullah.today>
░▓▓▓▓▓▓▓▓▓▓
░░░░░░░░░░

░▀█▀░█▄█░█░█░█░█░░░█▀▀░▀█▀░█▀█░▀█▀░█░█░█▀▀
░░█░░█░█░█░█░▄▀▄░░░▀▀█░░█░░█▀█░░█░░█░█░▀▀█
░░▀░░▀░▀░▀▀▀░▀░▀░░░▀▀▀░░▀░░▀░▀░░▀░░▀▀▀░▀▀▀
'

battery1() {
  SYSFS=/sys/class/power_supply
  BATTERY=BAT0
  MAINS=AC
  POWER_NOW=$(cat $SYSFS/$BATTERY/power_now)
  ENERGY_NOW=$(cat $SYSFS/$BATTERY/energy_now)
  ENERGY_FULL=$(cat $SYSFS/$BATTERY/energy_full)
  ENERGY_FULL_DESIGN=$(cat $SYSFS/$BATTERY/energy_full_design)
  AC_ON=$(cat $SYSFS/$MAINS/online)

  printf "%s%%" "$(( ENERGY_NOW * 100 / ENERGY_FULL ))"
  if [ $AC_ON -ne 0 ] ; then
    if [ $POWER_NOW -ne 0 ] ; then
      printf " charging in %smin" "$(( (ENERGY_FULL - ENERGY_NOW) * 60 / POWER_NOW ))"
    else
      printf " not charging"
    fi
  else
    if [ $POWER_NOW -ne 0 ] ; then
      printf " discharging in %smin" "$(( ENERGY_NOW * 60 / POWER_NOW ))"
    else
      printf " not discharging"
    fi
  fi
  printf " (%s%% of design)\n" "$(( ENERGY_FULL * 100 / ENERGY_FULL_DESIGN ))"
}

battery() {
    is_charger_connected=$(apm -a)
    battery_percentage=$(apm -l)
    if [ $is_charger_connected = 0 ]; then
        echo "Discharging: $battery_percentage%% "
    elif [ $is_charger_connected = 1 ]; then
        echo -n "Charging: $battery_percentage%% "
    fi

    unknown_status=$(apm -m)
    [ "$unknown_status" != "unknown" ] && echo " [$unknown_status minutes remaining] "
}

wifi() {
    wifi_state=$(ifconfig iwm0 | awk '/status:/ { print $2 }')
    ssid=$(ifconfig iwm0 | awk '/(nwid|join)/ { print $3 }')
    signals=$(ifconfig iwm0 | awk 'match($0, /[0-9]*%/) { print substr($0, RSTART, RLENGTH) }')
    echo "$ssid $signals" 
}

mails()
{
  mails_count=$(find $HOME/.mail/Inbox/new -type f -print | wc -l)
  if [ $mails_count -eq 0 ]
  then
    echo 'No new mails'
  elif
    [ $mails_count -eq 1 ]
  then
    echo ${mails_count} new mail
  elif
    [ $mails_count -gt 1 ]
  then
    echo ${mails_count} new mails
  fi
    
}


ram()
{
  ram=$(free | awk '/Mem:/ {print int($3/$2 * 100.0)}')
  echo 'RAM: '$ram%
}


just_ram()
{
  echo $(free | awk '/Mem:/ {print int($3/$2 * 100.0)}')%
  
}


date_time()
{
  date +'%a %d-%m %H:%M'
}


music()
{
  is_playing=$(mpc | grep "^\[playing\]" | awk '{print $1}')
  how_long_the_tags_are=$(mpc | head -1 | wc -c)
  shorter_tags=$(mpc --format='[%title% - %artist%]' current | head -1 | head -c 30)

  if [ "$is_playing" = "[playing]" ]; then
    if [ "$how_long_the_tags_are" -lt 30 ]; then
      echo "$(mpc --format='[%title% - %artist%]' current)"
    else
      echo "$shorter_tags..."
    fi
  fi
    

}

cpu() {
    cpu=$(ps -eo pcpu | awk 'BEGIN {sum=0.0f} {sum+=$1} END {print sum}')
    temperature=$(sysctl -n hw.sensors.cpu0.temp0 | cut -d ' ' -f 1 )
    echo "$cpu $temperature"
}

temperature()
{
  temp=$(($(cat /sys/class/thermal/thermal_zone0/temp) / 1000))°c
  echo $temp
}



echo `cpu` - `temperature` - `mails` - `wifi` - `battery` - `date_time`
